<!DOCTYPE html>
<html lang="en" dir="ltr">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Webpage</title>
    <style>
        body {
            display: none;  
        }
    </style><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Mean Variance Optimization | dosh blog</title>
<meta name="keywords" content="finance">
<meta name="description" content="Minimize risks(variances) by given returns import numpy as np import yfinance as yf import scipy.optimize as sco # Fetch historical data tickers = [&#39;AAPL&#39;, &#39;MSFT&#39;]# , &#39;GOOGL&#39;, &#39;AMZN&#39;] data = yf.download(tickers, start=&#39;2020-01-01&#39;, end=&#39;2021-01-01&#39;)[&#39;Adj Close&#39;] # Calculate daily returns returns = data.pct_change().dropna() # Define the objectives def portfolio_return(weights, returns): return np.sum(weights * returns.mean(axis=0)) def portfolio_variance(weights, returns): cov_matrix = np.cov(returns, rowvar=False) return np.sqrt(np.dot(weights.T, np.dot(cov_matrix, weights))) # Define the constraint (target return) def return_constraint(weights, returns, target_return): portfolio_return = np.">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/2024_07_30_mean_variance_optimization/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.83b11c62a43fbf757da2c58ea26772c3bb5f812e3d09f6488b03eca60260bc71.css" integrity="sha256-g7EcYqQ/v3V9osWOomdyw7tfgS49CfZIiwPspgJgvHE=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/2024_07_30_mean_variance_optimization/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="dosh blog (Alt + H)">dosh blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                
                <ul class="lang-switch">
                    
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/algotrade/" title="Finance">
                    <span>Finance</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">





<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Mean Variance Optimization
    </h1>
    <div class="post-meta"><span title='2024-07-30 00:00:01 +0900 JST'>July 30, 2024</span>

</div>
    
  </header>










   
    
      
      
      
      
      
      <img src="/posts/2024_07_30_mean_variance_optimization/cover_hu7cf208a13403d613c2cd4be9e9e8b2e3_457996_1024x512_fill_q75_box_center.jpg" alt="Cropped image" loading="eager" style="border-radius: 15px;">
    
 
  <div class="post-content"><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h3 id="minimize-risksvariances-by-given-returns">Minimize risks(variances) by given returns<a hidden class="anchor" aria-hidden="true" href="#minimize-risksvariances-by-given-returns">#</a></h3>




   


<div class="highlight">
   <div class="code-content">
     
     <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> yfinance <span style="color:#66d9ef">as</span> yf
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> scipy.optimize <span style="color:#66d9ef">as</span> sco
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Fetch historical data</span>
</span></span><span style="display:flex;"><span>tickers <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;AAPL&#39;</span>, <span style="color:#e6db74">&#39;MSFT&#39;</span>]<span style="color:#75715e"># , &#39;GOOGL&#39;, &#39;AMZN&#39;]</span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> yf<span style="color:#f92672">.</span>download(tickers, start<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;2020-01-01&#39;</span>, end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;2021-01-01&#39;</span>)[<span style="color:#e6db74">&#39;Adj Close&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Calculate daily returns</span>
</span></span><span style="display:flex;"><span>returns <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>pct_change()<span style="color:#f92672">.</span>dropna()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Define the objectives</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">portfolio_return</span>(weights, returns):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>sum(weights <span style="color:#f92672">*</span> returns<span style="color:#f92672">.</span>mean(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">portfolio_variance</span>(weights, returns):
</span></span><span style="display:flex;"><span>    cov_matrix <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>cov(returns, rowvar<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>sqrt(np<span style="color:#f92672">.</span>dot(weights<span style="color:#f92672">.</span>T, np<span style="color:#f92672">.</span>dot(cov_matrix, weights)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Define the constraint (target return)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">return_constraint</span>(weights, returns, target_return):
</span></span><span style="display:flex;"><span>    portfolio_return <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sum(weights <span style="color:#f92672">*</span> returns<span style="color:#f92672">.</span>mean())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> portfolio_return <span style="color:#f92672">-</span> target_return
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Initial guess for the weights</span>
</span></span><span style="display:flex;"><span>initial_guess <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0.5</span>]) <span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># initial_guess = np.array([0.25, 0.25, 0.25, 0.25])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Bounds for the weights (between 0 and 1)</span>
</span></span><span style="display:flex;"><span>bounds <span style="color:#f92672">=</span> tuple((<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(returns<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>]))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(returns<span style="color:#f92672">.</span>mean())
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Perform the optimization for different target returns</span>
</span></span><span style="display:flex;"><span>target_returns <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, returns<span style="color:#f92672">.</span>mean()<span style="color:#f92672">.</span>max(), <span style="color:#ae81ff">30</span>)
</span></span><span style="display:flex;"><span>optimal_portfolios <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> target_return <span style="color:#f92672">in</span> target_returns:
</span></span><span style="display:flex;"><span>    constraints <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>        {<span style="color:#e6db74">&#39;type&#39;</span>: <span style="color:#e6db74">&#39;eq&#39;</span>, <span style="color:#e6db74">&#39;fun&#39;</span>: <span style="color:#66d9ef">lambda</span> x: np<span style="color:#f92672">.</span>sum(x) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>},  <span style="color:#75715e"># sum of weights is 1</span>
</span></span><span style="display:flex;"><span>        {<span style="color:#e6db74">&#39;type&#39;</span>: <span style="color:#e6db74">&#39;eq&#39;</span>, <span style="color:#e6db74">&#39;fun&#39;</span>: return_constraint, <span style="color:#e6db74">&#39;args&#39;</span>: (returns, target_return)}  <span style="color:#75715e"># target return</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    result <span style="color:#f92672">=</span> sco<span style="color:#f92672">.</span>minimize(portfolio_variance, initial_guess, args<span style="color:#f92672">=</span>(returns,), method<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;SLSQP&#39;</span>, bounds<span style="color:#f92672">=</span>bounds, constraints<span style="color:#f92672">=</span>constraints)
</span></span><span style="display:flex;"><span>    optimal_portfolios<span style="color:#f92672">.</span>append((result<span style="color:#f92672">.</span>x, portfolio_return(result<span style="color:#f92672">.</span>x, returns), result<span style="color:#f92672">.</span>fun))
</span></span><span style="display:flex;"><span>    print(result<span style="color:#f92672">.</span>x)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Extract the results</span>
</span></span><span style="display:flex;"><span>weights, returns, variances <span style="color:#f92672">=</span> zip(<span style="color:#f92672">*</span>optimal_portfolios)
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plot the efficient frontier</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(variances, returns, <span style="color:#e6db74">&#39;o&#39;</span>, markersize<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;Risk (Variance)&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Return&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Efficient Frontier&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()</span></span></code></pre></div> 
   </div>
   <button class="copy-code" onclick="copyCodeToClipboard()">Copy</button>
</div>

<script>
   function copyCodeToClipboard() {
       
      var codeContent = document.querySelector('.code-content');
      
       
      var range = document.createRange();
      range.selectNode(codeContent);

       
      window.getSelection().removeAllRanges(); 
      window.getSelection().addRange(range);

       
      document.execCommand('copy');

       
      window.getSelection().removeAllRanges(); 
      alert('Code copied to clipboard!');
   }
</script>


<br>

<h3 id="maximize-returns-by-given-risksvariances">Maximize returns by given risks(variances)<a hidden class="anchor" aria-hidden="true" href="#maximize-returns-by-given-risksvariances">#</a></h3>




   


<div class="highlight">
   <div class="code-content">
     
     <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> yfinance <span style="color:#66d9ef">as</span> yf
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> scipy.optimize <span style="color:#66d9ef">as</span> sco
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Fetch historical data</span>
</span></span><span style="display:flex;"><span>tickers <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;AAPL&#39;</span>, <span style="color:#e6db74">&#39;MSFT&#39;</span>]<span style="color:#75715e"># , &#39;GOOGL&#39;, &#39;AMZN&#39;]</span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> yf<span style="color:#f92672">.</span>download(tickers, start<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;2020-01-01&#39;</span>, end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;2021-01-01&#39;</span>)[<span style="color:#e6db74">&#39;Adj Close&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Calculate daily returns</span>
</span></span><span style="display:flex;"><span>returns <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>pct_change()<span style="color:#f92672">.</span>dropna()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">portfolio_return</span>(weights, returns):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>sum(weights <span style="color:#f92672">*</span> returns<span style="color:#f92672">.</span>mean(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Define the objective function (negative portfolio return)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">neg_portfolio_return</span>(weights, returns):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span>np<span style="color:#f92672">.</span>sum(weights <span style="color:#f92672">*</span> returns<span style="color:#f92672">.</span>mean())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Define the constraint (target variance)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">variance_constraint</span>(weights, returns, target_variance):
</span></span><span style="display:flex;"><span>    portfolio_variance <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sqrt(np<span style="color:#f92672">.</span>dot(weights<span style="color:#f92672">.</span>T, np<span style="color:#f92672">.</span>dot(returns<span style="color:#f92672">.</span>cov(), weights)))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> portfolio_variance <span style="color:#f92672">-</span> target_variance
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Initial guess for the weights</span>
</span></span><span style="display:flex;"><span>initial_guess <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0.5</span>]) <span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># initial_guess = np.array([0.25, 0.25, 0.25, 0.25])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Bounds for the weights (between 0 and 1)</span>
</span></span><span style="display:flex;"><span>bounds <span style="color:#f92672">=</span> tuple((<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(returns<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>]))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(returns<span style="color:#f92672">.</span>cov()<span style="color:#f92672">.</span>max()<span style="color:#f92672">.</span>max())
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Perform the optimization for different target returns</span>
</span></span><span style="display:flex;"><span>target_risks <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0.02</span>, <span style="color:#ae81ff">0.03</span>, <span style="color:#ae81ff">30</span>)
</span></span><span style="display:flex;"><span>optimal_portfolios <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> target_risk <span style="color:#f92672">in</span> target_risks:
</span></span><span style="display:flex;"><span>    constraints <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>        {<span style="color:#e6db74">&#39;type&#39;</span>: <span style="color:#e6db74">&#39;eq&#39;</span>, <span style="color:#e6db74">&#39;fun&#39;</span>: <span style="color:#66d9ef">lambda</span> x: np<span style="color:#f92672">.</span>sum(x) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>},  <span style="color:#75715e"># sum of weights is 1</span>
</span></span><span style="display:flex;"><span>        {<span style="color:#e6db74">&#39;type&#39;</span>: <span style="color:#e6db74">&#39;eq&#39;</span>, <span style="color:#e6db74">&#39;fun&#39;</span>: variance_constraint, <span style="color:#e6db74">&#39;args&#39;</span>: (returns, target_risk)}  <span style="color:#75715e"># target return</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    result <span style="color:#f92672">=</span> sco<span style="color:#f92672">.</span>minimize(neg_portfolio_return, initial_guess, args<span style="color:#f92672">=</span>(returns,), method<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;SLSQP&#39;</span>, bounds<span style="color:#f92672">=</span>bounds, constraints<span style="color:#f92672">=</span>constraints)
</span></span><span style="display:flex;"><span>    optimal_portfolios<span style="color:#f92672">.</span>append((result<span style="color:#f92672">.</span>x, portfolio_return(result<span style="color:#f92672">.</span>x, returns), target_risk))
</span></span><span style="display:flex;"><span>    print(result<span style="color:#f92672">.</span>x)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Extract the results</span>
</span></span><span style="display:flex;"><span>weights, returns, variances <span style="color:#f92672">=</span> zip(<span style="color:#f92672">*</span>optimal_portfolios)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Plot the efficient frontier</span>
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>plot(variances, returns, <span style="color:#e6db74">&#39;o&#39;</span>, markersize<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;Risk (Variance)&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;Return&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Efficient Frontier&#39;</span>)
</span></span><span style="display:flex;"><span>plt<span style="color:#f92672">.</span>show()</span></span></code></pre></div> 
   </div>
   <button class="copy-code" onclick="copyCodeToClipboard()">Copy</button>
</div>

<script>
   function copyCodeToClipboard() {
       
      var codeContent = document.querySelector('.code-content');
      
       
      var range = document.createRange();
      range.selectNode(codeContent);

       
      window.getSelection().removeAllRanges(); 
      window.getSelection().addRange(range);

       
      document.execCommand('copy');

       
      window.getSelection().removeAllRanges(); 
      alert('Code copied to clipboard!');
   }
</script>


<br>

<h3 id="objective-function-for-maximizing-the-sharpe-ratio">Objective Function for Maximizing the Sharpe Ratio<a hidden class="anchor" aria-hidden="true" href="#objective-function-for-maximizing-the-sharpe-ratio">#</a></h3>




   


<div class="highlight">
   <div class="code-content">
     
     <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> yfinance <span style="color:#66d9ef">as</span> yf
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> scipy.optimize <span style="color:#66d9ef">as</span> sco
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Fetch historical data</span>
</span></span><span style="display:flex;"><span>tickers <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;AAPL&#39;</span>, <span style="color:#e6db74">&#39;MSFT&#39;</span>, <span style="color:#e6db74">&#39;GOOGL&#39;</span>, <span style="color:#e6db74">&#39;AMZN&#39;</span>]
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> yf<span style="color:#f92672">.</span>download(tickers, start<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;2023-01-01&#39;</span>, end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;2024-01-01&#39;</span>)[<span style="color:#e6db74">&#39;Adj Close&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Calculate daily returns</span>
</span></span><span style="display:flex;"><span>returns <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>pct_change()<span style="color:#f92672">.</span>dropna()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Function to calculate portfolio statistics</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">portfolio_stats</span>(weights, returns):
</span></span><span style="display:flex;"><span>    portfolio_return <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sum(weights <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>mean(returns, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)) <span style="color:#f92672">*</span> <span style="color:#ae81ff">252</span>  <span style="color:#75715e"># Annualize return</span>
</span></span><span style="display:flex;"><span>    portfolio_volatility <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sqrt(np<span style="color:#f92672">.</span>dot(weights<span style="color:#f92672">.</span>T, np<span style="color:#f92672">.</span>dot(np<span style="color:#f92672">.</span>cov(returns<span style="color:#f92672">.</span>T) <span style="color:#f92672">*</span> <span style="color:#ae81ff">252</span>, weights)))  <span style="color:#75715e"># Annualize volatility</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> portfolio_return, portfolio_volatility
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Objective function to minimize (negative Sharpe ratio)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">neg_sharpe_ratio</span>(weights, returns, risk_free_rate<span style="color:#f92672">=</span><span style="color:#ae81ff">0.0</span>):
</span></span><span style="display:flex;"><span>    portfolio_return, portfolio_volatility <span style="color:#f92672">=</span> portfolio_stats(weights, returns)
</span></span><span style="display:flex;"><span>    sharpe_ratio <span style="color:#f92672">=</span> (portfolio_return <span style="color:#f92672">-</span> risk_free_rate) <span style="color:#f92672">/</span> portfolio_volatility
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span>sharpe_ratio
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Constraints and bounds</span>
</span></span><span style="display:flex;"><span>constraints <span style="color:#f92672">=</span> ({<span style="color:#e6db74">&#39;type&#39;</span>: <span style="color:#e6db74">&#39;eq&#39;</span>, <span style="color:#e6db74">&#39;fun&#39;</span>: <span style="color:#66d9ef">lambda</span> x: np<span style="color:#f92672">.</span>sum(x) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>})  <span style="color:#75715e"># Sum of weights must be 1</span>
</span></span><span style="display:flex;"><span>bounds <span style="color:#f92672">=</span> tuple((<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(returns<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>]))  <span style="color:#75715e"># Weights between 0 and 1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Initial guess (equal weights)</span>
</span></span><span style="display:flex;"><span>initial_guess <span style="color:#f92672">=</span> returns<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> [<span style="color:#ae81ff">1.</span> <span style="color:#f92672">/</span> returns<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>]]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Optimization</span>
</span></span><span style="display:flex;"><span>result <span style="color:#f92672">=</span> sco<span style="color:#f92672">.</span>minimize(neg_sharpe_ratio, initial_guess, args<span style="color:#f92672">=</span>(returns,), method<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;SLSQP&#39;</span>, bounds<span style="color:#f92672">=</span>bounds, constraints<span style="color:#f92672">=</span>constraints)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Optimal weights</span>
</span></span><span style="display:flex;"><span>optimal_weights <span style="color:#f92672">=</span> result<span style="color:#f92672">.</span>x
</span></span><span style="display:flex;"><span>portfolio_return, portfolio_volatility <span style="color:#f92672">=</span> portfolio_stats(optimal_weights, returns)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Optimal weights: </span><span style="color:#e6db74">{</span>optimal_weights<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Expected portfolio return: </span><span style="color:#e6db74">{</span>portfolio_return<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Expected portfolio volatility: </span><span style="color:#e6db74">{</span>portfolio_volatility<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Optimal Sharpe ratio: </span><span style="color:#e6db74">{</span><span style="color:#f92672">-</span>result<span style="color:#f92672">.</span>fun<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)</span></span></code></pre></div> 
   </div>
   <button class="copy-code" onclick="copyCodeToClipboard()">Copy</button>
</div>

<script>
   function copyCodeToClipboard() {
       
      var codeContent = document.querySelector('.code-content');
      
       
      var range = document.createRange();
      range.selectNode(codeContent);

       
      window.getSelection().removeAllRanges(); 
      window.getSelection().addRange(range);

       
      document.execCommand('copy');

       
      window.getSelection().removeAllRanges(); 
      alert('Code copied to clipboard!');
   }
</script>




  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/finance/">Finance</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="http://localhost:1313/">dosh blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
        
        
        window.addEventListener('load', function () {
            
            document.body.style.display = 'block';
        });
    </script>
</body>

</html>
